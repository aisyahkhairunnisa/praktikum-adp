import os
import matplotlib.pyplot as plt
from termcolor import colored, cprint

os.system('cls')
def menyimpan_harian(nama,umur,tgl,bb,tb,minum,makan,K,P,S,olahraga,tidur):
    with open ('riwayat_kesehatan.txt', 'a') as f :
        f.write(f"{nama}-{umur}-{tgl}-{bb}-{tb}-{minum}-{makan}-{K}-{P}-{S}-{olahraga}-{tidur}\n")
    print(f'data tanggal {tgl} telah ditambahkan ke dalam riwayat kesehatan')

def menghapus_harian(tgl) :
	with open ('riwayat_kesehatan.txt','r') as f :
		lines=f.readlines()
	with open ('riwayat_kesehatan.txt','w') as f :
		hapus=False
		for i in lines :
			if i.split('-')[2]!= tgl :
				f.write(i)
			else :
				hapus=True
		if hapus :
			print(f' Data tanggal {tgl} sudah dihapus')
		else :
			print(f' Data tanggal {tgl} tidak ditemukan dalam data kesehatan')

def menampilkan():
	with open ('riwayat_kesehatan.txt','r') as f :
		lines=f.readlines()
		if not lines :
			print('Tidak ada data kesehatan')
		else :
			for i in lines :
				print(i.strip())

def analisis_kesehatan(bb, tb, bmi, jenis_kelamin, umur, olahraga):
    
    if bmi < 18.5:
        kategori_bmi = "Kurus"
    elif 18.5 <= bmi < 24.9:
        kategori_bmi = "Normal"
    elif 25 <= bmi < 29.9:
        kategori_bmi = "Overweight"
    else:
        kategori_bmi = "Obesitas"
    print("Kategori BMI anda adalah", kategori_bmi)

    if jenis_kelamin.lower() == 'pria':
        bmr = 88.362 + (13.397 * bb) + (4.799 * tb) - (5.677 * umur)
    else:
        bmr = 447.593 + (9.247 * bb) + (3.098 * tb) - (4.330 * umur)
    print("BMR anda adalah ",bmr)
    jumlah =0
    while olahraga=='ada' :
            jumlah+=1
    if jumlah == 0:
        tingkat_aktivitas = "sedentari"
    elif jumlah <= 8:
        tingkat_aktivitas = "ringan"
    elif jumlah <= 16:
        tingkat_aktivitas = "sedang"
    elif jumlah <= 24:
        tingkat_aktivitas = "aktif"
    else:
        tingkat_aktivitas = "sangat aktif"

    faktor_aktivitas = {
            "sedentari": 1.2,
            "ringan": 1.375,
            "sedang": 1.55,
            "aktif": 1.725,
            "sangat aktif": 1.9
        }
    kalori=bmr * faktor_aktivitas.get(tingkat_aktivitas.lower(), 1.2)
    return kalori
    
def saran_kesehatan(K, P, S, bmi, kalori, minum, makan, tidur):
    saran = "Saran Kesehatan:\n"
    if bmi < 18.5:
        saran += "- Makan lebih banyak makanan berkalori tinggi dan seimbang.\n"
    elif 25 <= bmi < 29.9:
        saran += "- Kurangi makanan tinggi kalori, perbanyak sayuran dan buah.\n"
    elif bmi >= 30:
        saran += "- Konsultasi dengan dokter atau ahli gizi untuk diet yang tepat.\n"
    saran += f"- Anda memerlukan sekitar {kalori:.2f} kalori per hari berdasarkan tingkat aktivitas Anda.\n"
    
    if minum < 8 :
        saran += "- Anda harus memperhatikan asupan cairan anda, Asupan cairan harian anda masih kurang\n"
    elif minum >= 8 :
        saran += "- Asupan cairan anda sudah cukup, pertahankan kebiasaan anda\n"
    saran += f"- Asupan cairan disarankan 8 gelas air mineral dalam sehari\n"

    if makan < 3 :
        saran += "- Perbaiki pola makan anda. Anda harus menjaga energi dan keseimbangan nutrisi anda\n"
    elif makan == 3 :
        saran += "- Pola makan anda sudah baik, pertahankan kebiasaan anda\n"
    elif makan > 3 :
        saran += "- Asupan makanan anda berlebih, kurangi asupan makanan anda agar tida terkena obesitas\n"
    saran += "- Dalam sehari disarankan makan 3 kali sehari, yaitu sarapan, makan siang, dan makan malam"

    if K == 'ada' :
        if P == 'ada' :
            if S == 'ada' :
                saran += "Porsi makan anda sudah bagus. Pertahankan porsi makan lengkap anda"
            else :
                saran += "Perbaiki nutrisi yang anda konsumsi ! Anda kekurangan serat, serat penting untuk proses metabolisme tubuh." 
        else :
            if S == 'ada' :
                saran += "Perbaiki nutrisi yang anda konsumsi ! Anda kekurangan protein, protein sangat dibutuhkan untuk fungsi biologis"
            else :
                saran +="Perbaiki nutrisi yang anda konsumsi ! Anda kekurangan protein dan serat, protein sangat dibutuhkan untuk fungsi biologis dan serat dibutuhkan untuk proses metabolisme anda."
    else :
        if P == 'ada' :
            if S == 'ada' :
                saran =+ "Jangan lupakan karbohidrat ! karbohidrat sangat penting untuk energi anda "
            else :
               saran =+ "Jangan lupakan karbohidrat dan serat ! karbohidrat sangat penting untuk energi anda dan serat penting untuk proses metabolisme tubuh." 
        else :
            if S == 'ada' :
                saran =+ "Jangan lupakan karbohidrat dan protein ! karbohidrat sangat penting untuk energi anda dan protein sangat penting untuk fungsi biologis. "
            else :
                saran =+ "Porsi makan anda sangat tidak baik untuk nutrisi tubuh ! perbaiki nutrisi makan anda dengan mengonsumsi porsi seimbang." 
    saran += "- Dalam satu porsi makanan harus dilengkapi dengan Karbohidrat, Protein, dan Serat."
    

    if tidur < 8 :
        saran += "- Anda harus menambah waktu istirahat anda\n"
    elif tidur == 8 :
        saran += "- Waktu istirahat anda sudah cukup, pertahankan pola istirahat anda\n"
    else : 
        saran += "- Waktu istirahat anda berlebih, perbanyak aktivitas produktif\n"
    saran += "- Anda memerlukan waktu istirahat selama 8 jam dalam sehari\n"
    return saran

def tampilkan_grafik(data):
    labels = ["Berat badan", "Tinggi badan", "Jam Tidur", "Olahraga"]
    values = [data["Berat badan"], data["Tinggi badan"], data["Jam Tidur"], data["Olahraga"]]
    plt.figure(figsize=(8, 5))
    plt.plot(labels, values, color=['blue', 'green', 'red', 'yellow'])
    plt.title('Grafik Data Kesehatan')
    plt.ylabel('Nilai')
    plt.show()

nama = input("Masukkan nama pengguna : ")
umur = input("Umur : ")
jenis_kelamin = input("jenis kelamin (pria/wanita) : ")
bb=float(input("Berat badan (dalam kg) : "))
tb=float(input("Tinggi badan (dalam cm) : "))
def menu(file):
    while True :
        print("1. Menambah data harian")
        print("2. Menghapus data harian")
        print("3. Tampilkan riwayat data kesehatan ")
        print("4. Tampilkan analisis kesehatan")
        print("5. Saran Kesehatan")
        print("6. Tampilkan Grafik Kesehatan keseluruhan")
        print("7. Keluar dari aplikasi")
        pilihan=input("Masukkan nomor menu yang anda inginkan : ")
        if pilihan == '1' :
            tgl = input("Masukkan tanggal hari ini dengan format dd/mm/yyyy : ")
            minum = int(input("Berapa gelas anda minum hari ini ? (masukkan dalam angka banyak gelas) "))
            makan = int(input("Berapa Kali anda makan hari ini ? (masukkan dalam angka) "))
            print("Apa saja menu makanan anda hari ini " )
            K = input("Apakah ada karbohidrat ? (Jawab ada/tidak) ")
            P = input("Apakah ada Protein ? (Jawab ada/tidak) ")
            S = input("Apakah ada serat ? (Jawab ada/tidak) ")
            olahraga = input("Apakah hari ini anda berolahraga ? ")
            tidur = input("Bearapa lama waktu tidur anda kemarin ? (dalam jam) ")
            menyimpan_harian(nama,umur,tgl,bb,tb,minum,makan,K,P,S,olahraga,tidur)
        elif pilihan == '2' :
            tgl = input ("Masukkan tanggal, data yang ingin dihapus : ")
            menghapus_harian(tgl)
        elif pilihan == '3' :
            menampilkan()
        elif pilihan == '4' :
            bmi = bb /(tb / 100)
            analisis_kesehatan(bb, tb, bmi, jenis_kelamin, umur, olahraga)
        elif pilihan == '5' :
            kalori=analisis_kesehatan(bb, tb, bmi, jenis_kelamin, umur, olahraga)
            saran_kesehatan(K, P, S, bmi, kalori, minum, makan, tidur)
        elif pilihan == '6' :
            tampilkan_grafik()
        elif pilihan == '7' :
            print("Keluar dari aplikasi.")
            break
        else :
            print ('Pilihan tidak valid. Ulang masukkan Pilihan.')
file='riwayat_kesehatan.txt'
menu(file)
